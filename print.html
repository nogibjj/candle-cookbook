<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Candle Cookbook</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="home.html"><strong aria-hidden="true">1.</strong> Candle Cookbook</a></li><li class="chapter-item expanded "><a href="local/index.html"><strong aria-hidden="true">2.</strong> Local Builds</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="local/hello-candle.html"><strong aria-hidden="true">2.1.</strong> Hello, Candle!</a></li></ol></li><li class="chapter-item expanded "><a href="aws/index.html"><strong aria-hidden="true">3.</strong> AWS Builds</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="aws/hello-aws.html"><strong aria-hidden="true">3.1.</strong> Hello, Candle on AWS!</a></li><li class="chapter-item expanded "><a href="aws/jenkins-pipeline.html"><strong aria-hidden="true">3.2.</strong> CodePipeline + Jenkins Build</a></li></ol></li><li class="chapter-item expanded "><a href="azure/index.html"><strong aria-hidden="true">4.</strong> Azure Builds</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="azure/hello-azure.html"><strong aria-hidden="true">4.1.</strong> Hello, Candle on Azure!</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Candle Cookbook</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="candle-cookbook"><a class="header" href="#candle-cookbook">Candle Cookbook</a></h1>
<h2 id="-the-mission"><a class="header" href="#-the-mission">üöÄ The Mission:</a></h2>
<p>Democratize access to state of the art AI models.</p>
<h2 id="-the-principles"><a class="header" href="#-the-principles">üåè The Principles:</a></h2>
<p>ü´±üèæ‚Äçü´≤üèº <strong>Trust</strong> ~ ethically sourced data and end-to-end transparency.</p>
<p>üîí <strong>Privacy</strong> ~ secure, on-device inference without data sharing.</p>
<p>üå± <strong>Sustainability</strong> ~ optimize efficiency to minimize our carbon footprint.</p>
<h2 id="-contributing"><a class="header" href="#-contributing">üå± Contributing</a></h2>
<p>We welcome contributions from anyone who aligns with Our Mission and Our Principles.</p>
<p>Get started by reading our <a href="https://github.com/nogibjj/candle-cookbook/blob/main/CODE_OF_CONDUCT.md">Code of Conduct</a> then check out the <a href="https://github.com/nogibjj/candle-cookbook/blob/main/CONTRIBUTING.md">Contributor Guidelines</a>.</p>
<h2 id="-the-recipes"><a class="header" href="#-the-recipes">üç≥ The Recipes:</a></h2>
<ul>
<li><a href="./local/index.html">Local Builds</a></li>
<li><a href="./aws/index.html">AWS Builds</a></li>
<li><a href="./azure/index.html">Azure Builds</a></li>
</ul>
<p><strong>Minimum requirements for GPU targetted binaries</strong></p>
<p>For CUDA enabled builds using <code>--features cuda</code>:</p>
<ul>
<li>NVIDIA GPU with <a href="https://developer.nvidia.com/cuda-gpus">CUDA compute capabilitity</a> &gt; X.X</li>
<li><a href="https://developer.nvidia.com/cuda-downloads">CUDA Toolkit</a> &gt;= X.X</li>
</ul>
<p>For cuDNN optimized builds using <code>--features cuda, cudnn</code>:</p>
<ul>
<li>NVIDIA GPU with <a href="https://developer.nvidia.com/cuda-gpus">CUDA compute capabilitity</a> &gt; X.X</li>
<li><a href="https://developer.nvidia.com/cuda-downloads">CUDA Toolkit</a> &gt;= X.X</li>
<li><a href="https://developer.nvidia.com/cudnn">cuDNN</a> &gt;= X.X</li>
</ul>
<p>Verify CUDA/cuDNN:</p>
<pre><code># Verify CUDA
nvidia-smi --query-gpu=compute_cap --format=csv
nvcc --version

# Verify cuDNN
whereis cudnn.h
</code></pre>
<p><strong>‚ö†Ô∏è IMPORTANT:</strong> </p>
<p>AWS/Azure builds may incur charges. It is your responsibility to understand the associated resource costs and useage rates. We are not liable for any charges incurred from the utilization of these services. </p>
<h2 id="roadmap"><a class="header" href="#roadmap">üõ£Ô∏èRoadmap</a></h2>
<p>Our goal is to document each stage of a fully transparent LLM development cycle</p>
<ul>
<li><input disabled="" type="checkbox"/>
Publish MVP Candle Cookbook</li>
<li><input disabled="" type="checkbox"/>
Ethically source and construct an openly available LLM dataset</li>
<li><input disabled="" type="checkbox"/>
Build a Candle-based LLM from scratch</li>
<li><input disabled="" type="checkbox"/>
Customize LLM with finetuning</li>
<li><input disabled="" type="checkbox"/>
CI/CD deployment of LLM</li>
</ul>
<h2 id="-our-team"><a class="header" href="#-our-team">üßë‚Äçüç≥ Our Team:</a></h2>
<p>Get to know our <a href="https://github.com/nogibjj/candle-cookbook/blob/main/TEAM.md">Community Leaders</a></p>
<h2 id="official-candle-docs"><a class="header" href="#official-candle-docs">üïØÔ∏èOfficial Candle Docs</a></h2>
<ul>
<li><a href="https://github.com/huggingface/candle">Huggingface Candle repo</a></li>
<li><a href="https://huggingface.github.io/candle/guide/installation.html">Candle User Guide</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="local-builds"><a class="header" href="#local-builds">Local Builds</a></h1>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<p><strong>Minimum requirements for GPU targetted binaries</strong></p>
<p>For CUDA enabled builds using <code>--features cuda</code>:</p>
<ul>
<li>NVIDIA GPU with <a href="https://developer.nvidia.com/cuda-gpus">CUDA compute capabilitity</a> &gt; X.X</li>
<li><a href="https://developer.nvidia.com/cuda-downloads">CUDA Toolkit</a> &gt;= X.X</li>
</ul>
<p>For cuDNN optimized builds using <code>--features cuda, cudnn</code>:</p>
<ul>
<li>NVIDIA GPU with <a href="https://developer.nvidia.com/cuda-gpus">CUDA compute capabilitity</a> &gt; X.X</li>
<li><a href="https://developer.nvidia.com/cuda-downloads">CUDA Toolkit</a> &gt;= X.X</li>
<li><a href="https://developer.nvidia.com/cudnn">cuDNN</a> &gt;= X.X</li>
</ul>
<p>Verify CUDA/cuDNN:</p>
<pre><code># Verify CUDA
nvidia-smi --query-gpu=compute_cap --format=csv
nvcc --version

# Verify cuDNN
whereis cudnn.h
</code></pre>
<h2 id="recipes"><a class="header" href="#recipes">Recipes</a></h2>
<p><strong>Getting Started</strong></p>
<ul>
<li><a href="local/./hello-candle.html">Hello, Candle!</a> ~ start here</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hello-candle"><a class="header" href="#hello-candle">Hello, Candle!</a></h1>
<h2 id="install-rust-via-rustup"><a class="header" href="#install-rust-via-rustup">Install Rust via <a href="https://rustup.rs/">rustup</a></a></h2>
<pre><code>curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --profile minimal --default-toolchain stable

# Set path
source &quot;$HOME/.cargo/env&quot;
</code></pre>
<h2 id="configure-candle"><a class="header" href="#configure-candle">Configure <a href="https://github.com/huggingface/candle">Candle</a></a></h2>
<pre><code>git clone https://github.com/huggingface/candle.git
cd candle
</code></pre>
<h2 id="build--run-binaries"><a class="header" href="#build--run-binaries">Build &amp; Run Binaries</a></h2>
<p>See all Candle example models <a href="https://github.com/huggingface/candle/tree/main/candle-examples/examples">here</a></p>
<p><em>Example:</em></p>
<pre><code># CPU build
cargo build --example falcon --release

# CUDA + cuDNN build
cargo build --example falcon --features cuda,cudnn --release

# Run binary
cd target/release/examples
./falcon --prompt &quot;who invented the lightbulb&quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="aws-builds"><a class="header" href="#aws-builds">AWS Builds</a></h1>
<h2 id="requirements-1"><a class="header" href="#requirements-1">Requirements</a></h2>
<ul>
<li>A <a href="https://github.com/join">Github Account</a></li>
<li>An <a href="https://portal.aws.amazon.com/billing/signup">AWS Account</a></li>
</ul>
<h2 id="recipes-1"><a class="header" href="#recipes-1">Recipes</a></h2>
<p><strong>Getting Started</strong></p>
<ul>
<li><a href="aws/./hello-aws.html">Hello, Candle on AWS!</a> ~ Hello, Candle! on AWS EC2 + S3</li>
</ul>
<p><strong>CI/CD Pipelines</strong></p>
<ul>
<li><a href="aws/./jenkins-pipeline.html">CodePipeline + Jenkins Build</a> ~ automated binary builds on EC2 with Jenkins + CodePipeline</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hello-candle-on-aws"><a class="header" href="#hello-candle-on-aws">Hello, Candle on AWS!</a></h1>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<ul>
<li>A <a href="https://github.com/join">Github Account</a></li>
<li>An <a href="https://portal.aws.amazon.com/billing/signup">AWS Account</a></li>
</ul>
<h2 id="create-candle-ec2-iam-user"><a class="header" href="#create-candle-ec2-iam-user">Create Candle-EC2 IAM User</a></h2>
<p>From AWS IAM Console &gt;&gt; Users &gt;&gt; Create User &quot;Candle-EC2&quot; &gt;&gt; Attach Policies Directly:</p>
<ul>
<li><code>AmazonS3FullAccess</code></li>
</ul>
<h2 id="launch-gpu-enabled-aws-ec2-compute-instance"><a class="header" href="#launch-gpu-enabled-aws-ec2-compute-instance">Launch GPU Enabled AWS EC2 Compute Instance</a></h2>
<ol>
<li>Open the AWS EC2 Console</li>
<li>Configure a Ubuntu 20.04 Deep Learning Base GPU AMI image + G5.##xlarge instance type (see <a href="https://aws.amazon.com/ec2/instance-types/g5/">here</a> for charges and instance capcity) </li>
<li>Create new key pair and save .pem file</li>
<li>Allow SSH traffic</li>
<li>Launch Instance</li>
<li>From EC2 landing page &gt;&gt; Start Instance</li>
</ol>
<p><em>Gotchas</em></p>
<ul>
<li>You may need to request capacity increase from AWS to handle larger G5.##xlarge instances</li>
<li>Move .pem file from downloads to ~/.ssh using <code>mv ~/Downloads/candle-key.pem ~/.ssh</code></li>
</ul>
<h2 id="connect-to-ec2-via-ssh"><a class="header" href="#connect-to-ec2-via-ssh">Connect to EC2 via SSH</a></h2>
<ol>
<li>Install <a href="https://code.visualstudio.com/docs/remote/ssh">Remote - SSH</a> from VSCode Extensions</li>
<li>Add new SSH Connection</li>
<li>From EC2 landing page &gt;&gt; Connect &gt;&gt; SSH client &gt;&gt; Copy commands to VSCode</li>
</ol>
<pre><code># NB: edit path to .pem file as needed
chmod 400 ~/.ssh/candle-key.pem
ssh -i &quot;~/.ssh/candle-key.pem&quot; ubuntu@ec2-##-##.us-east-1.compute.amazonaws.com
</code></pre>
<ol start="4">
<li>Update .config file and validate format as follows</li>
</ol>
<pre><code>Host ec2-##-###.us-east-1.compute.amazonaws.com
  HostName ec2-##-###.us-east-1.compute.amazonaws.com
  IdentityFile ~/.ssh/candle-key.pem
  User ubuntu
</code></pre>
<ol start="5">
<li>Confirm remote host platform (Linux) and fingerprint (Continue) </li>
<li>Launch terminal on remote host</li>
</ol>
<p><em>Gotchas</em></p>
<ul>
<li>If you stop and restart your EC2 instance, you will need to update the IP address in your .config file</li>
</ul>
<h2 id="verify-ec2-cudacudnn"><a class="header" href="#verify-ec2-cudacudnn">Verify EC2 CUDA/cuDNN</a></h2>
<pre><code>nvidia-smi --query-gpu=compute_cap --format=csv
nvcc --version

whereis cudnn.h
</code></pre>
<h2 id="install-rust-via-rustup-1"><a class="header" href="#install-rust-via-rustup-1">Install Rust via <a href="https://rustup.rs/">rustup</a></a></h2>
<pre><code>curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --profile minimal --default-toolchain stable

# Set path
source &quot;$HOME/.cargo/env&quot;
</code></pre>
<h2 id="install-aws-cli"><a class="header" href="#install-aws-cli">Install AWS CLI</a></h2>
<pre><code>curl &quot;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&quot; -o &quot;awscliv2.zip&quot;
unzip awscliv2.zip
sudo ./aws/install

# Check install
aws --version
</code></pre>
<h2 id="configure-candle-ec2-iam-user"><a class="header" href="#configure-candle-ec2-iam-user">Configure Candle-EC2 IAM User</a></h2>
<ol>
<li>IAM Console &gt;&gt; Users &gt;&gt; Candle-EC2 &gt;&gt; Security Credentials &gt;&gt; Create Access Key &quot;EC2-CLI&quot;</li>
<li>From EC2 SSH terminal</li>
</ol>
<pre><code>aws configure
# Copy-Paste Candle-EC2 Access Key ID
# Copy-Paste Candle-EC2 Secret Access Key
# Default region name: us-east-1
</code></pre>
<h2 id="configure-candle-1"><a class="header" href="#configure-candle-1">Configure <a href="https://github.com/huggingface/candle">Candle</a></a></h2>
<pre><code>git clone https://github.com/huggingface/candle.git
cd candle
</code></pre>
<h2 id="build--run-binaries-1"><a class="header" href="#build--run-binaries-1">Build &amp; Run Binaries</a></h2>
<p>See all Candle example models <a href="https://github.com/huggingface/candle/tree/main/candle-examples/examples">here</a></p>
<p><em>Example:</em></p>
<pre><code># CPU build
cargo build --example falcon --release

# CUDA + cuDNN build
cargo build --example falcon --features cuda,cudnn --release

# Run binary
cd target/release/examples
./falcon --prompt &quot;who invented the lightbulb&quot;
</code></pre>
<h2 id="store-binaries-in-s3"><a class="header" href="#store-binaries-in-s3">Store Binaries in S3</a></h2>
<p>From AWS S3 Console &gt;&gt; Create S3 Bucket i.e <code>my-candle-binaries</code></p>
<pre><code># Copy model binary from EC2 to S3 
cd target/release/examples
aws s3 cp quantized s3://my-candle-binaries
</code></pre>
<p><strong>IMPORTANT! Terminate any AWS resources to prevent unexpected charges.</strong> </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="automate-binary-builds-with-jenkins--codepipeline"><a class="header" href="#automate-binary-builds-with-jenkins--codepipeline">Automate Binary Builds with Jenkins + CodePipeline</a></h1>
<h2 id="prerequisites-1"><a class="header" href="#prerequisites-1">Prerequisites</a></h2>
<ul>
<li>Complete the <a href="aws/./hello-aws.html">Hello, Candle! on AWS</a> tutorial to setup your EC2 Instance, S3 Bucket and Candle-EC2 IAM User.</li>
<li>A <a href="https://github.com/join">Github Account</a></li>
<li>An <a href="https://portal.aws.amazon.com/billing/signup">AWS Account</a></li>
</ul>
<h2 id="add-permissions-to-candle-ec2-iam-role"><a class="header" href="#add-permissions-to-candle-ec2-iam-role">Add Permissions to Candle-EC2 IAM Role</a></h2>
<ol>
<li>From AWS IAM Console &gt;&gt; Users &gt;&gt; Candle-EC2 &gt;&gt; Add permissions &gt;&gt; Attach existing policies directly</li>
<li>Add <code>AWSCodePipelineCustomActionAccess</code> policy &gt;&gt; Save changes</li>
</ol>
<h2 id="integrate-jenkins-with-codepipeline"><a class="header" href="#integrate-jenkins-with-codepipeline">Integrate Jenkins with CodePipeline</a></h2>
<p><strong>Add Security Group to EC2</strong></p>
<ol>
<li>From EC2 landing page &gt;&gt; Network &amp; Security &gt;&gt; Security Groups </li>
<li>Create Security Group &gt;&gt; Name: &quot;WebConnectEC2&quot; &gt;&gt; Description: &quot;Allow SSH and HTTP traffic to EC2&quot;</li>
<li>Add the following inbound rules. NB: Source = &quot;Anywhere&quot; is not recommended for production environments.</li>
</ol>
<p><img src="aws/../assets/aws/jenkins-pipeline/aws-ec2-security-group.png" alt="image" /></p>
<ol start="4">
<li>Click EC2 instance &gt;&gt; Actions &gt;&gt; Networking &gt;&gt; Change Security Groups &gt;&gt; Select &quot;WebConnectEC2&quot; &gt;&gt; Save</li>
</ol>
<p><strong>Install Jenkins on EC2</strong></p>
<pre><code># Get Jenkins files
curl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key | sudo tee \
  /usr/share/keyrings/jenkins-keyring.asc &gt; /dev/null
echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \
  https://pkg.jenkins.io/debian-stable binary/ | sudo tee \
  /etc/apt/sources.list.d/jenkins.list &gt; /dev/null

# Install Jenkins
sudo apt-get update \
  &amp;&amp;
sudo apt-get install jenkins

# Check install
jenkins --version

# Allow Jenkins service to start at boot
sudo systemctl enable jenkins

# Launch Jenkins
sudo systemctl start jenkins
</code></pre>
<p><strong>Create Jenkins Admin/Login to Jenkins</strong></p>
<ol>
<li>Click EC2 instance &gt;&gt; Details &gt;&gt; Copy EC2 Public IPv4 DNS</li>
<li>From browser navigate to http://&lt;EC2_public_ipv4_address&gt;:8080/</li>
<li>From EC2 SSH terminal &gt;&gt; <code>sudo cat /var/lib/jenkins/secrets/initialAdminPassword</code> &gt;&gt; Copy password</li>
<li>Paste password into Jenkins &gt;&gt; Continue &gt;&gt; Install suggested plugins</li>
<li>Create admin user (suggested username: admin) &gt;&gt; Save and Continue</li>
<li>Instance Configuration &gt;&gt; Not Now</li>
</ol>
<p><em>Gotchas</em></p>
<p>To clean install Jenkins</p>
<pre><code>sudo apt-get remove --purge jenkins
rm -rf /var/lib/jenkins
</code></pre>
<p><strong>Create Jenkins Build Project</strong></p>
<ol>
<li>From Jenkins dashboard &gt;&gt; New Item &gt;&gt; Enter item name: &quot;CandlePipeline&quot; &gt;&gt; Select &quot;Freestyle project&quot; &gt;&gt; OK</li>
<li>General &gt;&gt; Check &quot;Execute concurrent builds if necessary&quot;</li>
<li>Source Code Management &gt;&gt; Check AWS CodePipeline</li>
<li>From AWS IAM &gt;&gt; Users &gt;&gt; Candle-EC2 &gt;&gt; create second access key &quot;Jenkins&quot; &gt;&gt; Add to Jenkins Build AWS Config</li>
<li>Category &gt;&gt; Build</li>
<li>Provider: Jenkins</li>
<li>Build Triggers &gt;&gt; Check &quot;Poll SCM&quot; &gt;&gt; Schedule: * * * * *</li>
<li>Build Steps &gt;&gt; Add build step &gt;&gt; Execute shell &gt;&gt; Add command:</li>
</ol>
<pre><code>ls
export PATH=/usr/local/cuda-11.8/bin:$PATH
export PATH=/home/ubuntu/.cargo/bin:$PATH
. &quot;/home/ubuntu/.cargo/env&quot;
rustc --version
cargo --version
nvcc --version
nvidia-smi
cargo build --example quantized --features cuda,cudnn --release
cargo build --example falcon --features cuda,cudnn --release
</code></pre>
<ol start="9">
<li>Post-build Actions &gt;&gt; Add post-build action &gt;&gt; AWS CodePipeline Publisher</li>
<li>Output location &gt;&gt; Add &gt;&gt; Artifact Location: /target/release/examples &gt;&gt; Artifact Name: BuildArtifact</li>
</ol>
<p><strong>Create CodePipeline Project</strong></p>
<ol>
<li>AWS CodePipeline Console &gt;&gt; Create pipeline &gt;&gt; Pipeline name: &quot;CandlePipeline&quot; &gt;&gt; Check &quot;New service role&quot;</li>
<li>Advanced Settings &gt;&gt; Custom location &gt;&gt; Bucket: &quot;my-candle-binaries&quot; &gt;&gt; Default AWS Managed Key &gt;&gt; Next</li>
<li>Source provider &gt;&gt; Github (Version 2) &gt;&gt; Follow instructions to create Github Connection</li>
<li>Uncheck &quot;Start the pipeline on source code change&quot;</li>
<li>Repository name: huggingface/candle &gt;&gt; Branch Name: main &gt;&gt; Output artifact format:CodePipeline Default &gt;&gt; Next</li>
<li>Build Provider &gt;&gt; Add Jenkins</li>
<li>Provider Name: Jenkins <strong>NB: Must match Jenkins Build Project!</strong></li>
<li>Server URL: http://&lt;EC2_public_ipv4_address&gt;:8080/</li>
<li>Project Name: CandlePipeline <strong>NB: Must match Jenkins Build Project!</strong> &gt;&gt; Next</li>
<li>Skip deploy stage &gt;&gt; Skip</li>
<li>Review &gt;&gt; Create pipeline</li>
<li>The first build will run automatically. Subsequent builds can be triggered using &quot;Release change&quot; button.</li>
</ol>
<h2 id="download-binaries"><a class="header" href="#download-binaries">Download Binaries</a></h2>
<ol>
<li>AWS S3 Console &gt;&gt; my-candle-binaries &gt;&gt; CandlePipeline/ &gt;&gt; BuildArtif/</li>
<li>Order by &quot;Last modified&quot; &gt;&gt; Download latest zip</li>
</ol>
<p><strong>IMPORTANT! Terminate any AWS resources to prevent unexpected charges.</strong> </p>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ul>
<li><a href="https://www.jenkins.io/doc/book/installing/linux/#debianubuntu">Install Jenkins to EC2</a></li>
<li><a href="https://www.jenkins.io/doc/tutorials/tutorial-for-installing-jenkins-on-AWS/#installing-and-configuring-jenkins">Jenkins on EC2</a></li>
<li><a href="https://docs.aws.amazon.com/codepipeline/latest/userguide/tutorials-four-stage-pipeline.html#tutorials-four-stage-pipeline-prerequisites-jenkins-iam-role/">Jenkins + AWS Codepipeline</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="azure-builds"><a class="header" href="#azure-builds">Azure Builds</a></h1>
<h2 id="requirements-2"><a class="header" href="#requirements-2">Requirements</a></h2>
<ul>
<li>A <a href="https://github.com/join">Github Account</a></li>
<li>An <a href="https://azure.microsoft.com/en-us/free">Azure Account</a></li>
</ul>
<h2 id="recipes-2"><a class="header" href="#recipes-2">Recipes</a></h2>
<p><strong>Getting Started</strong></p>
<ul>
<li><a href="azure/./hello-azure.html">Hello, Azure!</a> ~ Hello, Candle! on Azure</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
